<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Override Personal Leads rule -->
    <function name="write" model="ir.model.data">
        <function name="search" model="ir.model.data">
            <value eval="[('module', '=', 'crm'), ('name', '=', 'crm_rule_personal_lead')]"/>
        </function>
        <value eval="{'noupdate': False}"/>
    </function>

    <record id="crm.crm_rule_personal_lead" model="ir.rule">
        <field name="name">Personal Leads</field>
        <field ref="crm.model_crm_lead" name="model_id"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
    </record>

    <!-- Create rules directly with even more simplified approach -->
    <function model="ir.model" name="create_and_get_rules">
        <value eval="('crm.lead.collection', [
            {
                'name': 'Lead Collection User',
                'domain_force': '[(&quot;lead_id.user_id&quot;, &quot;=&quot;, user.id)]',
                'groups': [(4, ref('sales_team.group_sale_salesman'))]
            },
            {
                'name': 'Lead Collection Manager',
                'domain_force': '[(1, &quot;=&quot;, 1)]',
                'groups': [(4, ref('sales_team.group_sale_manager'))]
            }
        ])"/>
    </function>

    <function model="ir.model" name="create_and_get_rules">
        <value eval="('crm.lead.call.history', [
            {
                'name': 'Personal Call History',
                'domain_force': '[(&quot;user_id&quot;, &quot;=&quot;, user.id)]',
                'groups': [(4, ref('sales_team.group_sale_salesman'))],
                'perm_read': True,
                'perm_write': False,
                'perm_create': True,
                'perm_unlink': False
            },
            {
                'name': 'All Call History for Managers',
                'domain_force': '[(1, &quot;=&quot;, 1)]',
                'groups': [(4, ref('sales_team.group_sale_manager'))],
                'perm_read': True,
                'perm_write': True,
                'perm_create': True,
                'perm_unlink': True
            }
        ])"/>
    </function>
    
    <!-- Add walkin security rules -->
    <function model="ir.model" name="create_and_get_rules">
        <value eval="('crm.lead.walkin', [
            {
                'name': 'Personal Walk-ins',
                'domain_force': '[(&quot;user_id&quot;, &quot;=&quot;, user.id)]',
                'groups': [(4, ref('sales_team.group_sale_salesman'))],
                'perm_read': True,
                'perm_write': True,
                'perm_create': True,
                'perm_unlink': False
            },
            {
                'name': 'All Walk-ins for Managers',
                'domain_force': '[(1, &quot;=&quot;, 1)]',
                'groups': [(4, ref('sales_team.group_sale_manager'))],
                'perm_read': True,
                'perm_write': True,
                'perm_create': True,
                'perm_unlink': True
            }
        ])"/>
    </function>
</odoo>